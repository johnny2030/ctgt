<admintpl file="header" />
<style>
<!--
.btn-group {border: 1px solid #e9eef3;border-radius: 3px;}
.btn-group.open .btn.dropdown-toggle {background-color:#fff;}
.btn-group>.btn {background-color:#fff;color:#a6b3b9;}
.caret {border-top: 4px solid #a6b3b9;}
.dropdown-menu {background-color:#fff;}
.multiselect-container>li>a>label.checkbox {margin-left:5px;color:#a6b3b9;}
.multiselect-container>li.active>a>label.checkbox {margin-left:5px;color:#fff;}
-->
</style>
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:U('activity/index')}">{:L('ACTIVITY_LIST')}</a></li>
			<li><a href="{:U('activity/add')}">{:L('ACTIVITY_ADD')}</a></li>
			<!-- <li><a href="{:U('activity/ac_upload')}">活动信息上传</a></li> -->
		</ul>
		<form class="well form-search" method="post" id="cid-form" >
			<select name="classify_id" style="width:150px;">{$classify_html}</select>
			<!-- <select name="term_year_sess[]" id="term_year_sess" multiple="multiple">{$term_html}</select> -->
			<input type="text" name="activity_name" style="width:200px;" value="{$activity_name}" placeholder="{:L('ACTIVITY_NAME')}" />
			<button class="btn btn-primary">{:L('SEARCH')}</button>
			<a class="btn btn-danger" href="{:U('activity/index')}">{:L('EMPTY')}</a>
			<a class="btn btn-success" href="{:U('portal/activity/index')}" target="_blank">{:L('VIEW_THE_FRONT_END_LIST')}</a>
		</form>
		<script type="text/javascript">
			//多选下拉框
			//定义参数，更多参数查询bootstrap-mutiselect组件api
			$('#term_year_sess').multiselect({
				nonSelectedText: "{:L('ACTIVITY_TERM')}",
				buttonWidth:"150px"
			});
			
		</script>
		<form class="js-ajax-form" method="post">
			<div class="table-actions">
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('activity/listorders')}">{:L('SORT')}</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('activity/recommend',array('recommend'=>1))}" data-subcheck="true">{:L('RECOMMEND')}</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('activity/recommend',array('unrecommend'=>1))}" data-subcheck="true">{:L('CANCEL_RECOMMENDED')}</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('activity/toggle',array('hide'=>1))}" data-subcheck="true">{:L('HIDE')}</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('activity/toggle',array('display'=>1))}" data-subcheck="true">{:L('DISPLAY')}</button>
				<button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('activity/delete')}" data-subcheck="true" data-msg="{:L('DELETE_CONFIRM_MESSAGE')}">{:L('BATCH_DELETE')}</button>
			</div>
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th width="10"><label><input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x"></label></th>
						<th width="20">{:L('SORT')}</th>
						<th width="20">{:L('ID')}</th>
						<th width="300">{:L('ACTIVITY_NAME')}</th>
						<th width="50">{:L('SIGNUP_INFORMATION')}</th>
						<th width="20">{:L('STATUS')}</th>
						<th width="100">{:L('ACTIONS')}</th>
					</tr>
				</thead>
				<foreach name="list" item="acty">
					<tr>
						<td><input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$acty.id}"></td>
						<td><input name='listorders[{$acty.id}]' class="input input-order mr5" type='text' size='3' value='{$acty.listorder}'></td>
						<td>{$acty.id}</td>
						<td><a href="{:U('portal/activity/detail',array('id'=>$acty['id']))}" target="_blank"><span>{$acty.activity_name}</span><if condition="$acty.status eq 1">&nbsp;&nbsp;&nbsp;<a data-toggle="tooltip" title="{:L('已结束')}"><img src="__PUBLIC__/images/end.png"/></a></if></a></td>
						<php>
							$activity_students = D('Users')->alias('u')->join('__ACTIVITY_STUDENT_RELATIONSHIP__ asr ON asr.student_id=u.id')->where(array('asr.activity_id' => $acty['id']))->select();
							$activity_student_count = count($activity_students);
						</php>
						<notempty name="activity_students">
							<td><a href="javascript:open_iframe_dialog('{:U('activity/allot_student_list',array('id' => $acty['id']))}','{:L('STUDENT_LIST')}')">{:L('VIEW_DETAILS')}( {$activity_student_count} )</a></td>
						<else/>
							<td>{:L('NO_DATA')}</td>
						</notempty>
						<td>
							<if condition="$acty.activity_status eq 1">
								<a data-toggle="tooltip" title="{:L('DISPLAY')}"><i class="fa fa-check"></i></a>
							<else />
								<a data-toggle="tooltip" title="{:L('HIDE')}"><i class="fa fa-close"></i></a>
							</if>
							<if condition="$acty.activity_recommended eq 3">
								<a data-toggle="tooltip" title="{:L('HAVE_RECOMMENDED')}"><i class="fa fa-thumbs-up"></i></a>
							<else />
								<a data-toggle="tooltip" title="{:L('NOT_RECOMMENDED')}"><i class="fa fa-thumbs-down"></i></a>
							</if>
						</td>
						<td>
							<a href="{:U('activity/edit',array('id'=>$acty['id']))}" class="btn btn-warning btn-small">{:L('EDIT')}</a>
							<a href="{:U('activity/delete',array('id'=>$acty['id']))}" class="btn btn-danger btn-small js-ajax-delete" data-msg="{:L('DELETE_CONFIRM_MESSAGE')}">{:L('DELETE')}</a>
							<!-- <a href="javascript:open_iframe_dialog('{:U('activity/line_plan',array('id'=>$acty['id']))}','{:L('ACTIVITY_ROUTE_PLANNING')}')" class="btn btn-info btn-small">{:L('ACTIVITY_ROUTE_PLANNING')}</a> -->
							<a href="javascript:open_iframe_dialog('{:U('mailer/activity_send_mails',array('activity_id'=>$acty['id']))}','{:L('SEND_MAIL')}')" class="btn btn-warning btn-small">{:L('SEND_MAIL')}</a>
							<if condition="$acty.status eq 0">
								<a href="{:U('activity/end',array('id'=>$acty['id']))}" class="btn btn-danger btn-small js-ajax-delete" data-msg="{:L('END_CONFIRM_MESSAGE')}">{:L('END')}</a>
							<else />
								<if condition="$acty.credit_flg eq 1">
									<a href="javascript:open_iframe_dialog_uploadimg('{:U('activity/grant',array('id'=>$acty['id']))}','{:L('ACTIVITY_CREDITS_ISSUED')}')" class="btn btn-success btn-small">{:L('ACTIVITY_CREDITS_ISSUED')}</a>
								</if>
							</if>
							<br />
						</td>
					</tr>
				</foreach>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		setCookie('refersh_time', 0);
		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if (refersh_time == 1) {
				window.location.reload();
			}
		}
		setInterval(function() {
			refersh_window()
		}, 2000);
		$(function() {
			$("#selected-cid").change(function() {
				$("#cid-form").submit();
			});
		});
	</script>
</body>
</html>