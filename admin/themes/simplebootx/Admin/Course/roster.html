<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<form class="well form-search" method="post" id="cid-form" >
			<!-- <input type="text" name="keyword" style="width: 200px;" value="{$keyword}" placeholder="">
			<button class="btn btn-primary">搜索</button>
			<a class="btn btn-danger" href="{:U('course/index')}">清空</a> -->
			{:L('COURSE_TERM_SEARCH_HEAD')} >>
		</form>
		<form class="js-ajax-form" method="post">
			<div class="table-actions">
				<!-- <button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('course/term_toggle',array('hide'=>1))}" data-subcheck="true">隐藏</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('course/term_toggle',array('display'=>1))}" data-subcheck="true">显示</button> -->
			</div>
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th width="10">{:L('NO')}</th>
						<th width="50">Year</th>
						<th width="50">Term</th>
						<th width="100">Session</th>
						<th width="50">{:L('COURSE_INFORMATION')}</th>
					</tr>
				</thead>
				<volist name="list" id="vo">
					<php>
						$where = array();
						if($vo['year']) $where['year'] = $vo['year'];
						if($vo['term']) $where['term'] = $vo['term'];
						if($vo['session']) {
							$where['session'] = $vo['session'];
						} else {
							$where['session'] = '';
						}
						$term_courses = D('TermCourseRelationship')->field('distinct course_id')->where($where)->select();
						$term_courses_count = count($term_courses);
					</php>
					<tr>
						<td>{$i}</td>
						<td>{$vo.year}</td>
						<td>{$vo.term}</td>
						<td>{$vo.session}</td>
						<td>
							<if condition="$term_courses_count neq 0">
								<a href="javascript:open_iframe_dialog('{:U('course/roster_list',array('year' => str_replace('&','*',trim($vo['year'])),'term' => str_replace('&','*',trim($vo['term'])),'session' => str_replace('&','*',trim($vo['session']))))}','{:L('COURSE_LIST')}')">{:L('VIEW_DETAILS')}( {$term_courses_count} )</a>
							<else/>
								{:L('NO_DATA')}
							</if>
						</td>
					</tr>
				</volist>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		setCookie('refersh_time', 0);
		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if (refersh_time == 1) {
				window.location.reload();
			}
		}
		setInterval(function() {
			refersh_window()
		}, 2000);
		$(function() {
			$("#selected-cid").change(function() {
				$("#cid-form").submit();
			});
		});
	</script>
</body>
</html>