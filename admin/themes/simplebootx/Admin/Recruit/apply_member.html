<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li><a href="{:U('recruit/index')}">{:L('RECRUIT_LIST')}</a></li>
			<li class="active"><a href="javascript:void(0);">{:L('RECRUIT_REQUEST')}</a></li>
		</ul>
		<form class="well form-search" method="post" action="{:U(admin/recruit/apply_member)}">
			<input type="hidden" name="id" value="{$id}">
			<select name="interview_status" style="width:150px;">
				<option value="0" <?php echo $interview_status == 0 ? 'selected' : '' ?> >{:L('CHECK_PENDING')}</option>
				<option value="1" <?php echo $interview_status == 1 ? 'selected' : '' ?> >{:L('APPROVE')}</option>
				<option value="2" <?php echo $interview_status == 2 ? 'selected' : '' ?> >{:L('UNAPPROVE')}</option>
				<option value="3" <?php echo $interview_status == 3 ? 'selected' : '' ?> >{:L('INTERVIEW_SUCCESS')}</option>
				<option value="4" <?php echo $interview_status == 4 ? 'selected' : '' ?> >{:L('INTERVIEW_FAILED')}</option>
				<option value="5" <?php echo $interview_status == 5 ? 'selected' : '' ?> >{:L('RESERVED')}</option>
			</select> &nbsp;
			<input type="text" name="keyword" style="width:200px;" value="{$keyword}" placeholder="姓名/手机号/邮箱" /> &nbsp;
			<if condition="$recruit_type eq 1 AND $interview_status eq 5">
				{:L('RECRUIT_APPOINTMENT_DATE')}：
				<input type="text" name="start_date" class="js-date" value="{$start_date|default=''}" style="width: 120px;" autocomplete="off"> -
				<input type="text" name="end_date" class="js-date" value="{$end_date|default=''}" style="width: 120px;" autocomplete="off"> &nbsp;
			</if>
			<button type="submit" class="btn btn-primary">{:L('SEARCH')}</button>
			<if condition="$recruit_type eq 1">
				<a class="btn btn-danger" href="{:U('recruit/apply_member',array('interview_status' => $interview_status,'id' => $id))}">{:L('EMPTY')}</a>
			</if>
			<br>
			<br>
			<span style="color:blue;"> {$recruit_name} </span>{:L('RECRUIT_APPLY_MEMBER_HEAD')} >>
		</form>
		<form class="js-ajax-form" method="post">
			<div class="table-actions">
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('check_pass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('APPROVE')}</button>
				<button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('check_nopass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('UNAPPROVE')}</button>
				<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('interview_pass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('INTERVIEW_SUCCESS')}</button>
				<button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('interview_nopass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('INTERVIEW_FAILED')}</button>
				<if condition="$interview_status eq 3 AND $recruit_type eq 1">
					<button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('renew_pass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('续住通过')}</button>
					<button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('renew_nopass'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('续住未通过')}</button>
				</if>
				<if condition="$interview_status eq 3 AND $recruit_type eq 2">
					<button class="btn btn-success btn-small js-ajax-submit" type="submit" data-action="{:U('recruit/exchange_status',array('interview_success'=>1,'recruit_id' => $id,'interview_status' => $interview_status))}" data-subcheck="true">{:L('生成账号')}</button>
				</if>
			</div>
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th width="16"><label><input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x"></label></th>
						<th width="30">{:L('NO')}</th>
						<th width="30">{:L('ID')}</th>
						<th width="100">{:L('RECRUIT_REAL_NAME')}</th>
						<th width="100">{:L('RECRUIT_PHONE')}</th>
						<th width="200">{:L('RECRUIT_EMAIL')}</th>
						<th width="100">{:L('STATUS')}</th>
						<if condition="$interview_status eq 5">
							<th width="200">{:L('RECRUIT_APPOINTMENT_TIME')}</th>
						</if>
						<th width="100">{:L('创建时间')}</th>
						<th width="100">{:L('更新时间')}</th>
						<th width="50">{:L('RECRUIT_RESUME')}</th>
						<if condition="$interview_status eq 1 OR $interview_status eq 2">
							<th width="50">{:L('ACTIONS')}</th>
						</if>
					</tr>
				</thead>
				<volist name="list" id="vo">
					<tr>
						<td><input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}"></td>
						<td>{$i}</td>
						<td>{$vo.id}</td>
						<td>{$vo.name}</td>
						<td>{$vo.phone}</td>
						<td>{$vo.email}</td>
						<td>
							<notempty name="vo.renew_status">
								续住申请
							<else/>
								新同屋申请
							</notempty>
						</td>
						<php>$smeta = json_decode($vo['smeta'],true);</php>
						<if condition="$vo.interview_status eq 5">
							<td>
								<if condition="$vo.status eq 1">
									<php>
										$interview_date = D('RecruitInterviewdate')->where(array('id' => $vo['interviewdate_id']))->find();
										$interview_time = D('RecruitInterviewtime')->where(array('id' => $vo['interviewtime_id']))->find();
									</php>
									{:date('Y-m-d',strtotime($interview_date['interview_date']))} {:date('H:i',strtotime($interview_time['interview_start_time']))}-{:date('H:i',strtotime($interview_time['interview_end_time']))}
								</if>
								<if condition="$vo.status eq 2">
									{:date('Y-m-d H:i',strtotime($vo['teacher_interviewtime']))}
								</if>
							</td>
						</if>
						<td>{:date('Y-m-d H:i:s',strtotime($vo['create_time']))}</td>
						<td>
							<notempty name="vo.update_time">
								{:date('Y-m-d H:i:s',strtotime($vo['update_time']))}
							<else/>
								------
							</notempty>
						</td>
						<td>
							<!-- <a href="__ROOT__{$smeta.resume_url}" >{$smeta.resume_name}</a> -->
							<a href="{:U('portal/recruit/resume',array('recruit_member_id'=>$vo['id']))}" target="_blank" class="btn btn-small btn-success">{:L('VIEW')}</a>
						</td>
						<!-- <td>
							<if condition="$vo.interview_status eq 0">
								{:L('CHECK_PENDING')}
							</if>
							<if condition="$vo.interview_status eq 1">
								{:L('APPROVE')}
							</if>
							<if condition="$vo.interview_status eq 2">
								{:L('UNAPPROVE')}
							</if>
							<if condition="$vo.interview_status eq 3">
								{:L('INTERVIEW_SUCCESS')}
							</if>
							<if condition="$vo.interview_status eq 4">
								{:L('INTERVIEW_FAILED')}
							</if>
							<if condition="$vo.interview_status eq 5">
								{:L('RESERVED')}
							</if>
						</td> -->
						<php>$email_status = json_decode($vo['email_status'],true);</php>
						<if condition="$vo.interview_status eq 1">
							<td>
								<if condition="$vo.status eq 1">
									<a href="javascript:open_iframe_dialog('{:U('mailer/recruit_send_mails',array('recruit_member_id'=>$vo['id'],'approve' => 1))}','{:L('SEND_MAIL')}')">
										<if condition="empty($email_status['approve'])">
											<img style="height:20px;" src="__PUBLIC__/images/email_send.png" data-toggle="tooltip" title="{:L('SEND_MAIL')}"/>
										<else/>
											<img style="height:20px;" src="__PUBLIC__/images/email_success.png" data-toggle="tooltip" title="{:L('SENT')}"/>
										</if>
									</a>
								</if>
								<if condition="$vo.status eq 2">
									<a class="btn btn-warning btn-small" href="javascript:open_iframe_layer_small('{:U('recruit/enter_interviewtime',array('recruit_member_id' => $vo['id']))}','{:L('RECRUIT_ENTER_INTERVIEW_TIME')}')">{:L('RECRUIT_ENTER_INTERVIEW_TIME')}</a>
								</if>
							</td>
						</if>
						<if condition="$vo.interview_status eq 2">
							<td>
								<a href="javascript:open_iframe_dialog('{:U('mailer/recruit_send_mails',array('recruit_member_id'=>$vo['id'],'unapprove' => 1))}','{:L('SEND_MAIL')}')">
									<if condition="empty($email_status['unapprove'])">
										<img style="height:20px;" src="__PUBLIC__/images/email_send.png" data-toggle="tooltip" title="{:L('SEND_MAIL')}"/>
									<else/>
										<img style="height:20px;" src="__PUBLIC__/images/email_success.png" data-toggle="tooltip" title="{:L('SENT')}"/>
									</if>
								</a>
							</td>
						</if>
					</tr>
				</volist>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		setCookie('refersh_time', 0);
		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if (refersh_time == 1) {
				window.location.reload();
			}
		}
		setInterval(function() {
			refersh_window()
		}, 2000);
	</script>
</body>
</html>