<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<title>{$recruit_name} Join Us {$site_name}</title>
	
		<tc_include file='Public:head' />
		<link href="__TMPL__Public/css/style.css" rel="stylesheet">
	</head>
	<body>
		<tc_include file="Public:nav" />

		<!--content-->
		<div class="container">
			<div class="my-page">
				
				<div class="my-title">
					<h3>Recruitment Information</h3>
				</div>
				<div class="my-content">
					<div class="row" id="infos">
						<div class="house-title">
							<h3>{$recruit_name}    <span class="btn btn-success btn-xs">招聘中</span></h3>
							<p>{$recruit_description}</p>
						</div>
						<dl class="house-money"><dt>工资</dt><dd>{$recruit_wage}</dd></dl>
						<div class="col-md-12">
							<div class="text">
								<dl><dt>招聘人数</dt><dd>{$recruit_people_number} 人</dd></dl>
								<dl><dt>学历</dt><dd>{$recruit_education}</dd></dl>
								<dl><dt>工作经验</dt><dd>{$recruit_experience}</dd></dl>
								<dl><dt>面试地址</dt><dd>{$recruit_address}</dd></dl>
								<php>
									$userid = sp_get_current_userid();
									$recruit_member = D('RecruitMember')->where(array('user_id' => $userid))->find();
								</php>
								<empty name="userid">
									<a href="#login" data-toggle="modal" data-target="#myModal" class="btn btn-lg btn-warning"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Upload Resume</a>
									<br>
									<br>
								<else/>
									<if condition="empty($recruit_member)">
										<dl><dt></dt><dd><a href="#upload" data-toggle="modal" data-target="#uploadModal" class="btn btn-warning btn-lg"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span> Upload Resume</a></dd></dl>
									<else/>
										<if condition="$recruit_member.interview_status eq 0" >
											<dl><dt></dt><dd><a href="javascript:void(0);" class="btn btn-info btn-lg"></span><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> In Review...</a></dd></dl>
										</if>
										<if condition="$recruit_member.interview_status eq 1" >
											<dl><dt></dt><dd><a href="#appointment" data-toggle="modal" data-target="#appointmentModal" class="btn btn-success btn-lg"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Interview Appointment</a></dd></dl>	
										</if>
										<if condition="$recruit_member.interview_status eq 2" >
											<dl><dt></dt><dd><a href="javascript:void(0);" class="btn btn-danger btn-lg"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> Unapprove</a></dd></dl>
										</if>
										<if condition="$recruit_member.interview_status eq 3" >
											<dl><dt></dt><dd><a href="javascript:void(0);" class="btn btn-success btn-lg"><span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span> Interview Success</a></dd></dl>
										</if>
										<if condition="$recruit_member.interview_status eq 4" >
											<dl><dt></dt><dd><a href="javascript:void(0);" class="btn btn-danger btn-lg"><span class="glyphicon glyphicon-remove-sign" aria-hidden="true"></span> Interview Failed</a></dd></dl>
										</if>
										<if condition="$recruit_member.interview_status eq 5" >
											<php>
												$interview_date = D('RecruitInterviewdate')->where(array('id' => $recruit_member['interviewdate_id']))->find();
												$interview_time = D('RecruitInterviewtime')->where(array('id' => $recruit_member['interviewtime_id']))->find();
											</php>
											<dl><dt></dt><dd><a href="javascript:void(0);" class="btn btn-info btn-lg"><span class="glyphicon glyphicon-time" aria-hidden="true"></span> {:date('Y/m/d',strtotime($interview_date['interview_date']))} {:date('H:i',strtotime($interview_time['interview_time']))}</a></dd></dl>
										</if>
									</if>
								</empty>
							</div>
						</div>
					</div>
				</div>
				<div class="my-title">
					<h3>Recruitment Content</h3>
				</div>
				<div class="my-content">
					<div class="row">
						<div class="col-md-12">
							{$recruit_content}
						</div>
					</div>
				</div>
			</div>
			<img src="__TMPL__Public/img/logo-sa.png" class="center-block my-logo" />
		</div>
		<!--upload-->
		<div class="modal fade" tabindex="-1" role="dialog" id="uploadModal" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<img src="__TMPL__Public/img/logo-sa.png" class="modal-title center-block" id="myModalLabel" />
					</div>
					<div class="modal-body">
						<div class="panel panel-default myPanel" style="border-color: white;">
							<div class="panel-body">
								<!-- Tab panes -->
								<div class="tab-content" style="border: hidden;">
									<div role="tabpanel" class="tab-pane active" id="upload">
										<form id="uploadForm" method="post" enctype="multipart/form-data" class="form-horizontal" action="{:leuu('portal/recruit/confirm')}">
											<input type="hidden" name="recruit_id" value="{$id}" >
											<div class="form-group">
												<label class="col-sm-5 control-label" for="resume"><span class="glyphicon glyphicon-upload" aria-hidden="true"></span></label>
												<div class="col-sm-6">
													<a href="javascript:void(0);" class="upload">
														<input type="file" class="form-control" id="resume" name="resume" placeholder="resume" accept=".xls,.xlsx,.docx,.doc,.dot,.dotx,.docm"/>Select File
													</a>
												</div>
											</div>
											<br>
											<div class="form-group">
												<div class="col-sm-12">
													<button type="submit" class="btn btn-lg btn-primary center-block">Submit</button>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/upload-->
		<!--interview-->
		<div class="modal fade" tabindex="-1" role="dialog" id="appointmentModal" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<img src="__TMPL__Public/img/logo-sa.png" class="modal-title center-block" id="myModalLabel" />
					</div>
					<div class="modal-body">
						<div class="panel panel-default myPanel" style="border-color: white;">
							<div class="panel-body">
								<!-- Tab panes -->
								<div class="tab-content" style="border: hidden;">
									<div role="tabpanel" class="tab-pane active" id="appointment">
										<form id="appointmentForm" method="post" action="{:leuu('portal/recruit/confirm')}">
											<input type="hidden" name="recruit_member_id" value="{$recruit_member.id}" >
											<div class="form-group">
												<div class="col-sm-12">
													<dl>
														<dt>面试日期</dt>
														<br>
														<dd id="interview-date">
															<volist name="recruit_interviewdate" id="vo">
																<span class="btn btn-default" id="interview-date-{$vo.id}" onclick="selectDate({$vo.id})" title="{$vo.id}">{:date('Y/m/d',strtotime($vo['interview_date']))}</span>&nbsp;
															</volist>
														</dd>
													</dl>
													<input type="hidden" name="interviewdate_id" id="interviewdate_id" value="">
													<dl>
														<dt>面试时间</dt>
														<br>
														<dd id="interview-time">
															<volist name="recruit_interviewtime" id="vo">
																<span class="btn btn-default" id="interview-time-{$vo.id}" onclick="selectTime({$vo.id})" title="{$vo.id}">{:date('H:i',strtotime($vo['interview_time']))}</span>&nbsp;
															</volist>
														</dd>
													</dl>
													<input type="hidden" name="interviewtime_id" id="interviewtime_id" value="">
												</div>
											</div>
											<br>
											<div class="form-group">
												<div class="col-sm-12">
													<a href="javascript:void(0);" id="btn-submit" class="btn btn-lg btn-primary center-block">Submit</a>
												</div>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!--/interview-->
		<!-- FOOTER -->
		<tc_include file="Public:footer" />
		<tc_include file="Public:scripts" />
		<script>
			function selectDate(dateId) {
				$('#interview-date span').each(function() {    
					$(this).removeClass('btn-success');  
				}); 
				$('#interview-time span').each(function() {    
					$(this).removeClass('btn-success');
					$(this).removeClass('btn-danger'); 
				}); 
				$('#interview-date-'+dateId).addClass('btn-success');
				var date_title = $('#interview-date-'+dateId).attr('title');
				var recruit_id = {$id};
				$('#interviewdate_id').val(date_title);
				$.post('{:U("recruit/checkTime")}', {interviewdate_id: date_title,recruit_id: recruit_id}, function(data){
					//alert(data.toString().split(',').length);
					for(i=0;i<data.toString().split(',').length;i++) {
						//已选时间点变红，onclick失效
						$('#interview-time-'+data[i]).removeAttr('onclick');
						$('#interview-time-'+data[i]).addClass('btn-danger');
					}
				});
			}
			function selectTime(timeId) {
				$('#interview-time span').each(function() {    
					$(this).removeClass('btn-success');  
				}); 
				$('#interview-time-'+timeId).addClass('btn-success');
				$('#interviewtime_id').val($('#interview-time-'+timeId).attr('title'));
			}
			$('#btn-submit').click(function(){
				if ($('#interviewtime_id').val() == "" || $('#interviewdate_id').val() == "") {
					alert('Please select the interview datetime!');
				} else {
					$('#appointmentForm').submit();
				}
			});
		</script>
	</body>

</html>