<admintpl file="header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:U('teacher/index')}">{:L('TEACHER_LIST')}</a></li>
		</ul>
		<!-- <form class="well form-search" method="post" id="cid-form" >
			<input type="text" name="keyword" style="width: 200px;" value="{$keyword}" placeholder="姓名">
			<button class="btn btn-primary">搜索</button>
			<a class="btn btn-danger" href="{:U('teacher/index')}">清空</a>
		</form> -->
		<form class="js-ajax-form" method="post">
			<div class="table-actions">
				<!-- <button class="btn btn-primary btn-small js-ajax-submit" type="submit" data-action="{:U('course/toggle',array('display'=>1))}" data-subcheck="true">入职</button> -->
				<button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('teacher/toggle',array('hide'=>1))}" data-subcheck="true">{:L('TEACHER_DIMISSION')}</button>
				<!-- <button class="btn btn-danger btn-small js-ajax-submit" type="submit" data-action="{:U('course/delete')}" data-subcheck="true" data-msg="{:L('DELETE_CONFIRM_MESSAGE')}">删除</button> -->
			</div>
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th width="16"><label><input type="checkbox" class="js-check-all" data-direction="x" data-checklist="js-check-x"></label></th>
						<th width="50">{:L('ID')}</th>
						<th width="100">{:L('RECRUIT_REAL_NAME')}</th>
						<th width="50">{:L('RECRUIT_EMAIL')}</th> 
						<th width="50">{:L('RECRUIT_GENDER')}</th> 
						<!-- <th width="100">{:L('TEACHER_PROFESSION')}</th> -->
						<th width="100">{:L('TEACHER_ENTRY_TIME')}</th>
						<th width="100">{:L('TEACHER_DIMISSION_TIME')}</th>
						<th width="50">{:L('STATUS')}</th>
						<!-- <th width="100">操作</th> -->
					</tr>
				</thead>
				<foreach name="list" item="vo">
					<php>
						$email_conf = D('EmailConf')->where(array('admin_id' => $vo['id']))->find();
						$email = empty($vo['user_email']) ? $email_conf['email_address'] : $vo['user_email'];
					</php>
					<tr>
						<td><input type="checkbox" class="js-check" data-yid="js-check-y" data-xid="js-check-x" name="ids[]" value="{$vo.id}"></td>
						<td>{$vo.id}</td>
						<td>{$vo.full_name}</td>
						<td>{$email}</td>
						<td>
							<if condition="$vo.sex eq 1">
								男
							<elseif condition="$vo.sex eq 2"/>
								女
							<else/>
								保密
							</if>
						</td>
						<php>
							$teacher_majors = D('TeacherMajor')->alias('tm')->join('__TEACHER_MAJOR_RELATIONSHIP__ tmr ON tmr.major_id=tm.id')->where('tmr.teacher_id='.$vo["id"])->select();
						</php>
						<!-- <td>
							<foreach name="teacher_majors" item="tm">
								{$tm.teacher_major_name} &nbsp;&nbsp;&nbsp;
							</foreach>
						</td> -->
						<td>
							<notempty name="vo.teacher_join_time">
								{$vo.teacher_join_time}
							<else/>
								--
							</notempty>
						</td>
						<td>
							<notempty name="vo.teacher_leave_time">
								{$vo.teacher_leave_time}
							<else/>
								--
							</notempty>
						</td>
						<td>
							<if condition="$vo.user_status eq 1">
								<a data-toggle="tooltip" title="{:L('TEACHER_ON_JOB')}"><i class="fa fa-check"></i></a>
							<elseif condition="$vo.user_status eq 2"/>
								<a data-toggle="tooltip" title="{:L('CHECK_PENDING')}"><i class="fa fa-exclamation"></i></a>
							<else/>
								<a data-toggle="tooltip" title="{:L('TEACHER_DIMISSION')}"><i class="fa fa-close"></i></a>
							</if>
						</td>
						<!-- <td>
							<a href="{:U('teacher/edit',array('id'=>$vo['id']))}">{:L('EDIT')}</a>
							<a href="{:U('teacher/delete',array('id'=>$vo['id']))}" class="js-ajax-delete">{:L('DELETE')}</a>
							<br />
						</td> -->
					</tr>
				</foreach>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		setCookie('refersh_time', 0);
		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if (refersh_time == 1) {
				window.location.reload();
			}
		}
		setInterval(function() {
			refersh_window()
		}, 2000);
		$(function() {
			$("#selected-cid").change(function() {
				$("#cid-form").submit();
			});
			//学季三级联动
			$('#department').change(function(){
				var department_id=$(this).children('option:selected').val();
				$.post('{:U("course/getMajors")}', {did: department_id}, function(result){
					$("#major").html(result);
					$("#category").html("<option value='0'>请选择课程名称</option>")
				});
			});
			$('#major').change(function(){
				var major_id=$(this).children('option:selected').val();
				$.post('{:U("course/getCategories")}', {mid: major_id}, function(result){
					$("#category").html(result.category_html);
				});
			});
		});
	</script>
</body>
</html>