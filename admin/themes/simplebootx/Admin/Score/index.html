<admintpl file="header" />
<style>
<!--
.table-bordered td {border-bottom: 1px solid #ddd;border-top: 0 solid #ddd;border-right: 1px solid #ddd;}
-->
</style>
</head>
<body>
	<div class="wrap js-check-wrap">
		<form class="well form-search" method="post" id="cid-form" action="{:U('admin/score/index')}">
			<select name="term_year_sess" id="term_year_sess" style="width: 200px;">{$term_year_sess_html}</select>
			<select name="course" id="course" style="width: 200px;" >{$course_html}</select>
			<!-- <input type="text" name="keyword" style="width:350px;" value="{$keyword}" placeholder="请输入学生姓名/课程名/总成绩"> -->
			<button class="btn btn-primary">{:L('SEARCH')}</button>
			<a class="btn btn-danger" href="{:U('score/index')}">{:L('EMPTY')}</a>
			<notempty name="term_year_sess_val">
				<br>
				<br>
				{$search_info} <!-- <a href="javascript:open_iframe_dialog('{:U('mailer/score_student_mails',array('term_year_sess'=>$term_year_sess_val,'course_id' => $course_id))}','{:L('SEND_MAIL')}')" class="btn btn-warning btn-small">{:L('SEND_MAIL')}</a> -->
			</notempty>
			<notempty name="course_id">
				<a class="btn btn-success btn-small" href="{:U('score/export',array('course_id' => $course_id))}">{:L('EXPORT')}</a>
			</notempty>
		</form>
		<form class="js-ajax-form" method="post">
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th width="10">{:L('NO')}</th>
						<th width="100">{:L('STUDENT_NAME')}</th>
						<th width="20">{:L('ACTIONS')}</th>
						<th width="10">{:L('NO')}</th>
						<th width="100">{:L('STUDENT_NAME')}</th>
						<th width="20">{:L('ACTIONS')}</th>
						<th width="10">{:L('NO')}</th>
						<th width="100">{:L('STUDENT_NAME')}</th>
						<th width="20">{:L('ACTIONS')}</th>
					</tr>
				</thead>
				<tr>
					<volist name="list" id="vo">
						<php>
							$index = $i-1;;
							if ($index%3 == 0) echo '</tr><tr>';
						</php>
						<td>{$i}</td>
						<td>{$vo.full_name}</td>
						<td>
							<php>
								$where = array();
								$where['student_id'] = $vo['id'];
								if($course_id) {
									$where['course_id'] = $course_id;
								} else {
									$where['entry'] = "search";
								}
								$score_count = D('Score')->where($where)->count();
							</php>
							<notempty name="course_id">
									<a href="javascript:open_iframe_dialog('{:U('score/enter',array('student_id'=>$vo['id'],'course_id' => $course_id))}','{:L('SCORE_ENTER')}')" class="btn btn-warning btn-small">{:L('ENTER')}</a>
								<else/>
									<button class="btn btn-warning btn-small" type="button" id="student_{$vo.id}">{:L('ENTER')}</button>
								</notempty>
							<if condition="$score_count neq 0">
								<a href="javascript:open_iframe_dialog('{:U('score/detail',$where)}','{:L('GRADE_INFORMATION')}')" class="btn btn-success btn-small">{:L('VIEW')}</a>
							</if>
							<br />
						</td>
					</volist>
				</tr>
			</table>
			<div class="pagination">{$page}</div>
		</form>
	</div>
	<script src="__PUBLIC__/js/common.js"></script>
	<script>
		setCookie('refersh_time', 0);
		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if (refersh_time == 1) {
				window.location.reload();
			}
		}
		setInterval(function() {
			refersh_window()
		}, 2000);
		$(function() {
			$("#selected-cid").change(function() {
				$("#cid-form").submit();
			});
			//学季联动
			$('#term_year_sess').change(function(){
				var term_year_sess = $(this).children('option:selected').val();
				$.post('{:U("score/getCourses")}', {term_year_sess: term_year_sess}, function(result){
					$("#course").html(result);
				});
			});
			Wind.use('ajaxForm', 'artDialog', 'iframeTools', function() {
				//选择课程
				<?php
					foreach($list as $student) {
				?>
					$('#student_{$student.id}').click(function(e) {
						var student_id = {$student.id};
						
						art.dialog.open("__ROOT__/index.php?g=admin&m=student&a=select_course&id="+ student_id , {
							title : "选择课程",
							width : "300px"
						});
					});
				<?php	
					}
				?> 
			});
		});
		
	</script>
</body>
</html>